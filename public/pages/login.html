<!DOCTYPE html>
<html :class="{ 'theme-dark': dark }" x-data="data()" lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - Windmill Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../assets/css/tailwind.output.css" />
  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
  <script src="../assets/js/init-alpine.js"></script>
  <style>
    body {
      background-color: #f4f6f9;
      font-family: 'Open Sans', sans-serif;
    }

    .auth-container {
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .auth-form {
      background: #fff;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 400px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .btn-primary {
      width: 100%;
      padding: 12px;
    }

    .error-message {
      color: red;
      font-size: 14px;
    }

    .toggle-links {
      text-align: center;
      margin-top: 15px;
    }

    .toggle-links a {
      cursor: pointer;
      color: #007bff;
      text-decoration: none;
    }

    .toggle-links a:hover {
      text-decoration: underline;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <div class="flex items-center min-h-screen p-6 bg-gray-50 dark:bg-gray-900">
    <div class="flex-1 h-full max-w-4xl mx-auto overflow-hidden bg-white rounded-lg shadow-xl dark:bg-gray-800">
      <div class="flex flex-col overflow-y-auto md:flex-row">
        <div class="h-32 md:h-auto md:w-1/2">
          <img aria-hidden="true" class="object-cover w-full h-full dark:hidden" src="../assets/img/login-office.jpeg"
            alt="Office" />
          <img aria-hidden="true" class="hidden object-cover w-full h-full dark:block"
            src="../assets/img/login-office-dark.jpeg" alt="Office" />
        </div>
        <div class="flex items-center justify-center p-6 sm:p-12 md:w-1/2">
          <div class="w-full">
            <form id="loginForm">
              <h1 class="mb-4 text-xl font-semibold text-gray-700 dark:text-gray-200">
                Login
              </h1>
              <label class="block text-sm">
                <span class="text-gray-700 dark:text-gray-400">Email</span>
                <input type="email" id="loginEmail" name="email"
                  class="form-control block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                  placeholder="Jane Doe" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                  title="Enter a valid email like name@example.com" inputmode="email" required />

              </label>
              <div class="error-message" id="loginEmailError"></div>
              <label class="block mt-4 text-sm">
                <span class="text-gray-700 dark:text-gray-400">Password</span>
                <input type="password" id="loginPassword"
                  class="form-control block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                  placeholder="***************" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_]).{6,}"
                  title="Must be at least 6 characters, with uppercase, lowercase, a number, and a special character"
                  required />
              </label>
              <div class="error-message" id="loginPasswordError"></div>
              <!-- You should use a button here, as the anchor is only used for the example  -->
              <button type="submit"
                class="block w-full px-4 py-2 mt-4 text-sm font-medium leading-5 text-center text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-lg active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple">
                Log in
              </button>
              <div class="toggle-links">
                <p>Don't have an account? <a id="showSignup">Sign up</a></p>
              </div>

              <hr class="my-8" />

              <!-- <p class="mt-4">
                <a class="text-sm font-medium text-purple-600 dark:text-purple-400 hover:underline"
                  href="./forgot-password.html">
                  Forgot your password?
                </a>
              </p>
              <p class="mt-1">
                <a class="text-sm font-medium text-purple-600 dark:text-purple-400 hover:underline"
                  href="./create-account.html">
                  Create account
                </a>
              </p>-->
            </form>

            <form id="signupForm" class="hidden">
              <h1 class="mb-4 text-xl font-semibold text-gray-700 dark:text-gray-200">
                Create Account
              </h1>
              <label class="block text-sm">
                <span class="text-gray-700 dark:text-gray-400">Full Name</span>
                <input type="text" id="signupName" name="fullname"
                  class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                  placeholder="Jane Doe" pattern="^[A-Za-zÀ-ÿ ,.'-]{2,50}$"
                  title="Enter a valid name (letters, spaces, and punctuation only)" required />
                <div class="error-message" id="signupNameError"></div>
              </label>
              <label class="block text-sm">
                <span class="text-gray-700 dark:text-gray-400">Email</span>
                <input type="email" id="signupEmail" name="email"
                  class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                  placeholder="info@example.com" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" inputmode="email"
                  title="Enter a valid email like name@example.com" required />
                <div class="error-message" id="signupEmailError"></div>
              </label>
              <label class="block mt-4 text-sm">
                <span class="text-gray-700 dark:text-gray-400">Password</span>
                <input type="password" id="signupPassword"
                  class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                  placeholder="***************" minlength="6" maxlength="8"
                  pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_]).{6,}"
                  title="Must be at least 6 characters, with uppercase, lowercase, a number, and a special character"
                  required />
              </label>
              <div class="error-message" id="signupPasswordError"></div>
              <label class="block mt-4 text-sm">
                <span class="text-gray-700 dark:text-gray-400">Confirm Password</span>
                <input type="password" id="confirmPassword"
                  class="block w-full mt-1 text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:text-gray-300 dark:focus:shadow-outline-gray form-input"
                  placeholder="***************" minlength="6" maxlength="8"
                  pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_]).{6,}"
                  title="Must be at least 6 characters, with uppercase, lowercase, a number, and a special character"
                  required />
              </label>
              <div class="error-message" id="confirmPasswordError"></div>

              <!-- You should use a button here, as the anchor is only used for the example  -->
              <button type="submit"
                class="block w-full px-4 py-2 mt-4 text-sm font-medium leading-5 text-center text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-lg active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple">
                Sign Up
              </button>
              <div class="toggle-links">
                <p>Already have an account? <a id="showLogin">Login</a></p>
              </div>

              <hr class="my-8" />

              <!--<p class="mt-4">
                <a class="text-sm font-medium text-purple-600 dark:text-purple-400 hover:underline"
                  href="./forgot-password.html">
                  Forgot your password?
                </a>
              </p>
              <p class="mt-1">
                <a class="text-sm font-medium text-purple-600 dark:text-purple-400 hover:underline"
                  href="./create-account.html">
                  Create account
                </a>
              </p>-->
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDFhya_K5QXvKl-s3jMOEcDE5tseGMGAyo",
      authDomain: "drixpro-44d7e.firebaseapp.com",
      projectId: "drixpro-44d7e",
      storageBucket: "drixpro-44d7e.appspot.com",
      messagingSenderId: "757793478163",
      appId: "1:757793478163:web:38df279487d852536a51e6",
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginForm = document.getElementById('loginForm');
    const signupForm = document.getElementById('signupForm');
    const showSignup = document.getElementById('showSignup');
    const showLogin = document.getElementById('showLogin');

    showSignup.onclick = () => {
      loginForm.classList.add('hidden');
      signupForm.classList.remove('hidden');
    };

    showLogin.onclick = () => {
      signupForm.classList.add('hidden');
      loginForm.classList.remove('hidden');
    };

    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    // Login Handler
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value.trim();

      document.getElementById('loginEmailError').textContent = '';
      document.getElementById('loginPasswordError').textContent = '';

      if (!email || !isValidEmail(email)) {
        document.getElementById('loginEmailError').textContent = 'Enter a valid email.';
        return;
      }
      if (!password) {
        document.getElementById('loginPasswordError').textContent = 'Password is required.';
        return;
      }

      auth.signInWithEmailAndPassword(email, password)
        .then(userCred => {
          localStorage.setItem('userToken', userCred.user.uid);
          window.location.href = '../index.html';
        })
        .catch(err => {
          document.getElementById('loginPasswordError').textContent = err.message;
        });
    });

    // Signup Handler
    signupForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value.trim();
      const confirmPassword = document.getElementById('confirmPassword').value.trim();

      document.getElementById('signupNameError').textContent = '';
      document.getElementById('signupEmailError').textContent = '';
      document.getElementById('signupPasswordError').textContent = '';
      document.getElementById('confirmPasswordError').textContent = '';

      if (!name) {
        document.getElementById('signupNameError').textContent = 'Name is required.';
        return;
      }

      if (!isValidEmail(email)) {
        document.getElementById('signupEmailError').textContent = 'Invalid email format.';
        return;
      }

      if (password.length < 6) {
        document.getElementById('signupPasswordError').textContent = 'Password must be at least 6 characters.';
        return;
      }

      if (password !== confirmPassword) {
        document.getElementById('confirmPasswordError').textContent = 'Passwords do not match.';
        return;
      }

      auth.createUserWithEmailAndPassword(email, password)
        .then(userCred => {
          return db.collection('clients').doc(userCred.user.uid).set({
            name,
            email,
            password,
            accountBalance: 0,
            totalReturns: 0,
            totalWithdraws: 0,
            stocksBalance: 0,
            stocksReturn: 0,
            stocksInvested: 0,
            stocksProfit: 0,
            cryptoBalance: 0,
            cryptoReturn: 0,
            cryptoInvested: 0,
            cryptoProfit: 0,
            loanRequest: 0,
            loanStatus: [],
            loanLimit: 0,
            totalProperties: 0,
            monthlyIncome: 0,
            occupancyRate: 0,
            portfolioValue: 0,
            roiTimeline: [
              { "month": "Jan", "value": 5.1 },
              { "month": "Feb", "value": 5.5 },
              { "month": "Mar", "value": 6.2 }
            ],

            properties: [
              {
                "name": "Oceanview Villa",
                "location": "Malibu, CA",
                "status": "Occupied",
                "rent": 5000
              },
            ],
            activities: [
              {
                "type": "Withdraw",
                "amount": 18063.45,
                "status": "Approved",
                "date": "2024-06-10"
              },
            ],
            payments: [
              {
                "type": "Withdraw",
                "amount": 18063.45,
                "status": "Approved",
                "date": "2024-06-10"
              },
            ],
            messages: [],

            subscription: [],
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        })
        .then(() => {
          alert('Account created! You can now login.');
          signupForm.reset();
          signupForm.classList.add('hidden');
          loginForm.classList.remove('hidden');
        })
        .catch(err => {
          document.getElementById('signupEmailError').textContent = err.message;
        });
    });
  </script>
</body>

</html>